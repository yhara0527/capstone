---
title: "Exploring ASER2016 Pakistan Data"
author: "Yusei Hara"
date: "2020/10/1"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## ASER Pakistan 2016

<p>In this piece of paper, a set of data obtained from Annual Status of Education Report (ASER) is explored. The raw data was downloaded from the link here. https://palnetwork.org/aser-centre/</p>

### Preparation
#### Packages Used
```{r libraries, message=FALSE}
library(ggplot2)
library(gghighlight)
library(stringr)
library(jsonlite)
library(leaflet)
library(ggmap)
library(devtools)
library(dplyr)
library(dbplyr)
library(sqldf)
library(RMySQL)
library(cartography)
library(sf)
library(tmap)
library(raster)
library(spData)
library(maps)
library(mapdata)
library(maptools)
library(ggthemes)
# install.packages("choroplethrZip")
library(choroplethr)
library(choroplethrAdmin1)
library(choroplethrMaps)
library(tidyverse)
# library(choroplethrZip)
# library(spDataLarge)
# install.packages("spDataLarge") not available
```
#### Data Installation
```{r}
school <- read.csv("aser/ASER2016GSchool.csv")
child <- read.csv("aser/ASER2016Child.csv")
```
```{r}
RegionName <- c("2" = "Panjab", 
                "3" = "Sindh", 
                "4" = "Balochistan", 
                "5" = "Khyber Pakhtunkhwa", 
                "6" = "Gilgit-Baltistan", 
                "7" = "Azad Jammu and Kashmir", 
                "8" = "Islamabad - ICT", 
                "9" = "Federally Administrated Tribal Areas")
Gender <- c("0" = "Male",
            "-1" = "Female")
```

### Exploration
#### Checking Samplesizes
```{r}
length(unique(child$CID))
```
<p>The whole samplesize (the numebr of children) of this dataset is 255196.</p>
```{r}
child %>% 
  filter(DID == 266) %>% 
  summarize(N_hunza = length(unique(CID)))
```
<p>The samplesize of Hunza alone is 1641.</p>









### Exploration in Hunza
#### Gender Proportion
```{r}
child %>% 
  filter(DID == 266) %>% 
  summarize(gender_proportion = mean(C002))
```
<p>-1: female, 0: male<br>
gender_proportion = -0.5173675 means there are a little more girls in the dataset.</p>

#### Age of Children (C001)
```{r, message=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C001)) +
  geom_histogram()
```
<p>Age is well sparsed</p>

#### Eduation Status

```{r}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C003)) +
  geom_histogram(bins = 3)
```
<p>1 = never enrolled; 2 = drop-out; 3 = currently enrolled</p>

#### Education Status by Gender
```{r}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C003)) +
  geom_histogram(bins = 3, binwidth = 1) +
  facet_grid(~C002, labeller = labeller(C002 = Gender))
```
<p>Both genders look pretty good interms of the absolute number of currently-enrolled-children </p>

#### The Enrollment Rate by Gender
```{r, message=FALSE}
child %>% 
  filter(DID == 266) %>% 
  group_by(C002) %>% 
  summarize(enrollment_rate = mean(C003 == 3)) %>% 
  ungroup() %>% 
  ggplot(aes(C002, enrollment_rate)) +
  geom_col() +
  scale_y_continuous() +
  geom_label(aes(label = enrollment_rate)) +
  scale_x_continuous(breaks = c(-1, 0), labels = c("Female", "Male"))
```
<p>As a rate, both are doing pretty good</p>

#### Currently-Enrolled: Institution Type (C006)
1 = Government; 2 = Private; 3 = Madrasah(Conventional religious education) School; 4 = Other(Non formal education facility)
```{r, warning=FALSE, message=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C006)) +
  geom_histogram()
```

<p>Most children go to public schools or private schools</p>


#### Within Gilgit-Baltistan 
```{r}
child %>% 
  filter(RID == 6) %>% 
  group_by(DID) %>% 
  mutate(Current_Enrollment_Rate = mean(C003 == 3)) %>% 
  ggplot(aes(DID, Current_Enrollment_Rate)) +
  geom_count() +
  scale_x_continuous(breaks = 260:266, labels = c("Gilgit", "Diamer", "Skardu", "Ghanshe", "Astore", "Ghizer", "Hunza-Nagar"))
    
```
<p>Within Gilgit-Baltistan, Hunza is outperforming.</p>
```{r, warning=FALSE}
child %>% 
  filter(RID == 6) %>% 
  group_by(DID) %>% 
  ggplot(aes(DID, C010)) +
  geom_boxplot(aes(group = DID)) +
  scale_x_continuous(breaks = 260:266, labels = c("Gilgit", "Diamer", "Skardu", "Ghanshe", "Astore", "Ghizer", "Hunza-Nagar"))
```

#### Basic Learning Levels: Reading in Local/National Language (C010)
1 = Begginer/Nothing; 2 = Letters; 3 = Words; 4 = Sentences; 5 = Story
```{r, warning=FALSE, message=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C010)) +
  geom_histogram()
```

```{r}
child %>% 
  filter(DID == 266) %>% 
  summarize(na = sum(is.na(C010)))
```

#### Basic Learning Levels by Age
```{r, warning=FALSE, message=FALSE}
child %>% 
  filter(DID == 266, C013 != c(3,4)) %>% 
  ggplot(aes(C010)) +
  geom_histogram() +
  facet_grid(~C001)
# children at he age of 3 and 4 are removed for they have not data
```

#### Basic Learning Levels by Gender
```{r,message=FALSE, warning=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C010)) +
  geom_histogram() +
  facet_grid(~C002, labeller = labeller(C002 = Gender))
```

#### English Reading Levels (C013)
```{r, message=FALSE, warning=FALSE}
child %>% 
  filter(DID == 266, C013 != c(3,4)) %>% 
  ggplot(aes(C013)) +
  geom_histogram() +
  facet_grid(~C001)
# children at he age of 3 and 4 are removed for they have not data

```

#### English Reading Levels by Gender 
```{r, message=FALSE, warning=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C013)) +
  geom_histogram() +
  facet_grid(~C002, labeller = labeller(C002 = Gender))
```



### Comparison between Other Region
#### Current Enrollment Rate
```{r, message=FALSE}
child %>% 
  group_by(DID) %>% 
  mutate(avg = round(mean(C003 == 3), digits = 2)) %>% 
  ungroup() %>% 
  ggplot(aes(avg)) +
  geom_histogram() +
  facet_grid(~RID, labeller = labeller(RID = RegionName)) +
  labs(title = "Current Enrollment Rate by Region")
```

#### Female Average Learning Levels (Age or other variables are NOT adjusted)
```{r}
child %>% 
  filter(C002 == -1) %>% 
  group_by(DID) %>% 
  mutate(avg_learning = mean(C010, na.rm = TRUE)) %>% 
  ggplot(aes(DID, avg_learning, color = RID)) +
  geom_point() +
  geom_text(aes(label = DID), nudge_x = 5, check_overlap = TRUE)

```
```{r}
child %>% 
  filter(C002 == -1) %>% 
  group_by(DID) %>% 
  mutate(avg_learning = mean(C010, na.rm = TRUE)) %>% 
  ggplot(aes(DID, avg_learning, color = RID)) +
  geom_point() +
  geom_text(aes(label = DID), nudge_x = 5, check_overlap = TRUE) +
  gghighlight(RID == 6)
  
```
<p>It is interesting to note that Gilgit-Baltistan(RID==6) has a huge diversity in average learning levels of girls and Hunza(DID==266) is in the top group of all region.</p>


```{r, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
  
map <- read.csv("map/csvData.csv")
map$location <- str_remove(map$location, "https://www.google.com/maps/")
map$location <- str_remove(map$location, "^\\D")
map$location <- str_remove(map$location, "q=")
map

provDist <- read.csv("aser/ASER2016ProvDist.csv")

head(provDist)

child <- child %>% right_join(provDist[-1], by = "DID")

map$location <- str_split(map$location, pattern = ",")
col_names <- c("long", "lat")
a <- t(as.data.frame(map$location))
colnames(a) <- col_names
class(a)
lat <- a[,1]
long <- a[,2]
long <- as.vector(long)
long <- as.numeric(long)
lat <- as.vector(lat)
lat <- as.numeric(lat)

map <- map %>% 
  mutate(long = long, lat = lat)
map <- map[-3]

# height <- max(map$lat) - min(map$lat)
# width <- max(map$long) - min(map$long)
# pak_borders <- c(bottom  = min(map$lat)  - 0.1 * height, 
#                  top     = max(map$lat)  + 0.1 * height,
#                  left    = min(map$long) - 0.1 * width,
#                  right   = max(map$long) + 0.1 * width)
# 
# map_a <- get_stamenmap(pak_borders, zoom = 10, maptype = "toner-lite")
# 
# ggmap(map_a)


```

```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
data("admin1.map")
pak <- subset(admin1.map, admin == "pakistan")
region <- pak$region


pak %>% group_by(region) %>% 
  mutate(long_region = mean(long), lat_region = mean(lat)) %>% 
  ggplot() +
    geom_polygon(aes(long, lat, group = group),
                 fill = "white", color = "black") +
    theme_map() +
    geom_text(aes(long_region, lat_region, label = region))

```


```{r ,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
pak %>% group_by(region) %>% 
  mutate(long_region = mean(long), lat_region = mean(lat)) %>% 
  ggplot() +
    geom_polygon(aes(long, lat, group = group),
                 fill = "white", color = "black") +
    theme_map() +
    geom_text(aes(long_region, lat_region, label = region))
```


#### Pakistan Map
```{r map, error=FALSE, warning=FALSE}
data("admin1.map")
pak <- subset(admin1.map, admin == "pakistan")
region <- pak$region
ggplot() +
  geom_polygon(data = pak, aes(long, lat, group = group),
               fill = "white", color = "black") +
  geom_point(data = map, aes(long, lat, label = name)) +
  geom_text(data = map, aes(long, lat, label = name), check_overlap = TRUE, nudge_y = 1)


```



