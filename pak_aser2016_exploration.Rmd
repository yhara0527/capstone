---
title: "Exploring ASER2016 Pakistan Data"
author: "Yusei Hara"
date: "2020/10/1"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## ASER Pakistan 2016

<p>In this piece of paper, a set of data obtained from Annual Status of Education Report (ASER) is explored. The raw data was downloaded from the link here. https://palnetwork.org/aser-centre/</p>

### Preparation
#### Packages Used
```{r libraries, message=FALSE}
library(tidyverse)
library(ggplot2)
library(gghighlight)
library(stringr)
library(ggmap)
library(dplyr)
library(cartography)
library(sf)
library(tmap)
library(spData)
library(maps)
library(mapdata)
library(maptools)
library(ggthemes)
library(choroplethr)
library(choroplethrAdmin1)
library(choroplethrMaps)
library(rgdal)
# library(choroplethrZip)
# library(spDataLarge)
# install.packages("spDataLarge") not available
```
#### Data Installation
```{r}
read.csv("aser/ASER2016GSchool.csv")
school <- read.csv("aser/ASER2016GSchool.csv")
child <- read.csv("aser/ASER2016Child.csv")
```
```{r}
RegionName <- c("2" = "Panjab", 
                "3" = "Sindh", 
                "4" = "Balochistan", 
                "5" = "Khyber Pakhtunkhwa", 
                "6" = "Gilgit-Baltistan", 
                "7" = "Azad Jammu and Kashmir", 
                "8" = "Islamabad - ICT", 
                "9" = "Federally Administrated Tribal Areas")
Gender <- c("0" = "Male",
            "-1" = "Female")
```

### Exploration
#### Checking Samplesizes
```{r}
length(unique(child$CID))
```
<p>The whole samplesize (the numebr of children) of this dataset is 255196.</p>
```{r}
child %>% 
  filter(DID == 266) %>% 
  summarize(N_hunza = length(unique(CID)))
```
<p>The samplesize of Hunza alone is 1641.</p>









### Exploration in Hunza
#### Gender Proportion
```{r}
child %>% 
  filter(DID == 266) %>% 
  summarize(gender_proportion = mean(C002))
```
<p>-1: female, 0: male<br>
gender_proportion = -0.5173675 means there are a little more girls in the dataset.</p>

#### Age of Children (C001)
```{r, message=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C001)) +
  geom_histogram()
```
<p>Age is well sparsed</p>

#### Eduation Status

```{r}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C003)) +
  geom_histogram(bins = 3)
```
<p>1 = never enrolled; 2 = drop-out; 3 = currently enrolled</p>

#### Education Status by Gender
```{r}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C003)) +
  geom_histogram(bins = 3, binwidth = 1) +
  facet_grid(~C002, labeller = labeller(C002 = Gender))
```
<p>Both genders look pretty good interms of the absolute number of currently-enrolled-children </p>

#### The Enrollment Rate by Gender
```{r, message=FALSE}
child %>% 
  filter(DID == 266) %>% 
  group_by(C002) %>% 
  summarize(enrollment_rate = mean(C003 == 3)) %>% 
  ungroup() %>% 
  ggplot(aes(C002, enrollment_rate)) +
  geom_col() +
  scale_y_continuous() +
  geom_label(aes(label = enrollment_rate)) +
  scale_x_continuous(breaks = c(-1, 0), labels = c("Female", "Male"))
```
<p>As a rate, both are doing pretty good</p>

#### Currently-Enrolled: Institution Type (C006)
1 = Government; 2 = Private; 3 = Madrasah(Conventional religious education) School; 4 = Other(Non formal education facility)
```{r, warning=FALSE, message=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C006)) +
  geom_histogram()
```

<p>Most children go to public schools or private schools</p>


#### Within Gilgit-Baltistan 
```{r}
child %>% 
  filter(RID == 6) %>% 
  group_by(DID) %>% 
  mutate(Current_Enrollment_Rate = mean(C003 == 3)) %>% 
  ggplot(aes(DID, Current_Enrollment_Rate)) +
  geom_count() +
  scale_x_continuous(breaks = 260:266, labels = c("Gilgit", "Diamer", "Skardu", "Ghanshe", "Astore", "Ghizer", "Hunza-Nagar"))
    
```
<p>Within Gilgit-Baltistan, Hunza is outperforming.</p>
```{r, warning=FALSE}
child %>% 
  filter(RID == 6) %>% 
  group_by(DID) %>% 
  ggplot(aes(DID, C010)) +
  geom_boxplot(aes(group = DID)) +
  scale_x_continuous(breaks = 260:266, labels = c("Gilgit", "Diamer", "Skardu", "Ghanshe", "Astore", "Ghizer", "Hunza-Nagar"))
```

#### Basic Learning Levels: Reading in Local/National Language (C010)
1 = Begginer/Nothing; 2 = Letters; 3 = Words; 4 = Sentences; 5 = Story
```{r, warning=FALSE, message=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C010)) +
  geom_histogram()
```

```{r}
child %>% 
  filter(DID == 266) %>% 
  summarize(na = sum(is.na(C010)))
```

#### Basic Learning Levels by Age
```{r, warning=FALSE, message=FALSE}
child %>% 
  filter(DID == 266, C013 != c(3,4)) %>% 
  ggplot(aes(C010)) +
  geom_histogram() +
  facet_grid(~C001)
# children at he age of 3 and 4 are removed for they have not data
```

#### Basic Learning Levels by Gender
```{r,message=FALSE, warning=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C010)) +
  geom_histogram() +
  facet_grid(~C002, labeller = labeller(C002 = Gender))
```

#### English Reading Levels (C013)
```{r, message=FALSE, warning=FALSE}
child %>% 
  filter(DID == 266, C013 != c(3,4)) %>% 
  ggplot(aes(C013)) +
  geom_histogram() +
  facet_grid(~C001)
# children at he age of 3 and 4 are removed for they have not data

```

#### English Reading Levels by Gender 
```{r, message=FALSE, warning=FALSE}
child %>% 
  filter(DID == 266) %>% 
  ggplot(aes(C013)) +
  geom_histogram() +
  facet_grid(~C002, labeller = labeller(C002 = Gender))
```



### Comparison between Other Region
#### Current Enrollment Rate
```{r, message=FALSE}
child %>% 
  group_by(DID) %>% 
  mutate(avg = round(mean(C003 == 3), digits = 2)) %>% 
  ungroup() %>% 
  ggplot(aes(avg)) +
  geom_histogram() +
  facet_grid(~RID, labeller = labeller(RID = RegionName)) +
  labs(title = "Current Enrollment Rate by Region")
```

#### Female Average Learning Levels (Age or other variables are NOT adjusted)
```{r}
child %>% 
  filter(C002 == -1) %>% 
  group_by(DID) %>% 
  mutate(avg_learning = mean(C010, na.rm = TRUE)) %>% 
  ggplot(aes(DID, avg_learning, color = RID)) +
  geom_point() +
  geom_text(aes(label = DID), nudge_x = 5, check_overlap = TRUE)

```
```{r}
child %>% 
  filter(C002 == -1) %>% 
  group_by(DID) %>% 
  mutate(avg_learning = mean(C010, na.rm = TRUE)) %>% 
  ggplot(aes(DID, avg_learning, color = RID)) +
  geom_point() +
  geom_text(aes(label = DID), nudge_x = 5, check_overlap = TRUE) +
  gghighlight(RID == 6)
  
```
<p>It is interesting to note that Gilgit-Baltistan(RID==6) has a huge diversity in average learning levels of girls and Hunza(DID==266) is in the top group of all region.</p>


```{r, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
  
map <- read.csv("map/csvData.csv")
map$location <- str_remove(map$location, "https://www.google.com/maps/")
map$location <- str_remove(map$location, "^\\D")
map$location <- str_remove(map$location, "q=")
map

provDist <- read.csv("aser/ASER2016ProvDist.csv")

head(provDist)

child <- child %>% right_join(provDist[-1], by = "DID")

map$location <- str_split(map$location, pattern = ",")
col_names <- c("long", "lat")
a <- t(as.data.frame(map$location))
colnames(a) <- col_names
class(a)
lat <- a[,1]
long <- a[,2]
long <- as.vector(long)
long <- as.numeric(long)
lat <- as.vector(lat)
lat <- as.numeric(lat)

map <- map %>% 
  mutate(long = long, lat = lat)
map <- map[-3]

# height <- max(map$lat) - min(map$lat)
# width <- max(map$long) - min(map$long)
# pak_borders <- c(bottom  = min(map$lat)  - 0.1 * height, 
#                  top     = max(map$lat)  + 0.1 * height,
#                  left    = min(map$long) - 0.1 * width,
#                  right   = max(map$long) + 0.1 * width)
# 
# map_a <- get_stamenmap(pak_borders, zoom = 10, maptype = "toner-lite")
# 
# ggmap(map_a)


```

```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
data("admin1.map")
pak <- subset(admin1.map, admin == "pakistan")
region <- pak$region


pak %>% group_by(region) %>% 
  mutate(long_region = mean(long), lat_region = mean(lat)) %>% 
  ggplot() +
    geom_polygon(aes(long, lat, group = group),
                 fill = "white", color = "black") +
    theme_map() +
    geom_text(aes(long_region, lat_region, label = region))

```


```{r ,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
pak %>% group_by(region) %>% 
  mutate(long_region = mean(long), lat_region = mean(lat)) %>% 
  ggplot() +
    geom_polygon(aes(long, lat, group = group),
                 fill = "white", color = "black") +
    theme_map() +
    geom_text(aes(long_region, lat_region, label = region)) +
  coord_fixed()
```

### Spatial Analysis
#### Pakistan Map
```{r map, error=FALSE, warning=FALSE}
data("admin1.map")
pak <- subset(admin1.map, admin == "pakistan")
region <- pak$region

ggplot() +
  geom_polygon(data = pak, aes(long, lat, group = group),
               fill = "white", color = "black") +
  geom_point(data = map, aes(long, lat, label = name)) +
  geom_text(data = map, aes(long, lat, label = name), check_overlap = TRUE, nudge_y = 1) +
  coord_fixed()
<<<<<<< HEAD
=======


```

```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
map_child <- map %>% left_join(child, by = c("name" = "DNAME"))

ggplot() +
  geom_polygon(data = pak, aes(long, lat, group = group),
               fill = "white", color = "black") +
  geom_point(data = map_child, aes(long, lat, label = name, color = RNAME)) +
  geom_text(data = map_child, aes(long, lat, label = name), check_overlap = TRUE, nudge_y = 1)


map_child
map
child
```


```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ggplot() +
  geom_polygon(data = pak, aes(long, lat, group = group),
               fill = "white", color = "black") +
  geom_point(data = map_child, aes(long, lat, label = name)) +
  geom_text(data = map_child, aes(long, lat, label = name), check_overlap = TRUE, nudge_y = 1) +
  coord_fixed()

```

#### Districts Map
```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica <- sf::st_read("map/pak_ica_categories_areas_geonode_apr2017.shp")

ggplot(ica) +
  geom_sf() +
  geom_point(data = map_child, aes(long, lat, label = DID)) +
  geom_text(data = map_child, aes(long, lat, label = DID), check_overlap = TRUE)

ica %>% 
  mutate(
    centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(aes(x, y))
```
```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(aes(x, y)) +
  geom_text(aes(x, y, label = Districts),size = 2, check_overlap = TRUE, nudge_y = 1)
```


```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df <- ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
  as.data.frame()
ica_df
ica_df <- ica_df %>% select(Province, Districts, x, y)
ica_df <- ica_df %>% summarize(Province = tolower(Province), Districts = tolower(Districts), x = x, y = y)


```


```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_2 <- ica_df %>% filter(Province == "punjab")
ica_df_2$Districts <- ica_df_2$Districts %>%  
  str_replace("bahawalnagar", "bahawalnager") %>%
  str_replace("jhelum", "Jehlum") %>% 
  str_replace("leiah", "layyah") %>% 
  str_replace("mandi bahauddin", "mandi bahuddin") %>% 
  as.vector()

child_dname <- child %>% mutate(dname = tolower(DNAME))

child_dname_2 <- child_dname %>% filter(RNAME == "Punjab") %>% left_join(ica_df_2, by = c("dname" = "Districts"))

child_dname_2 %>% group_by(dname) %>% summarize(n = sum(x))
ica_df_2
```
```{r}
ica_df_3 <- ica_df %>% filter(Province == "sindh")

ica_df_3$Districts <- ica_df_3$Districts %>%  
  str_replace("ghotki", "gotki") %>%
  str_replace("mirpur khas", "mirpurkhas") %>% 
  str_replace("malir karachi", "karachi-malir-rural") %>% 
  str_replace("naushahro feroze", "nowshero feroze") %>% 
  str_replace("kambar shahdad kot", "qambar shahdadkot") %>% 
  str_replace("sujawal", "sajawal") %>% 
  str_replace("shaheed benazir abad", "shaheed benazirabad") %>% 
  str_replace("tando allahyar", "tando allah yar") %>% 
  as.vector()

child_dname_3 <- child_dname %>% filter(RNAME == "Sindh") %>% left_join(ica_df_3, by = c("dname" = "Districts"))

child_dname_3 %>% group_by(dname) %>% summarize(n = sum(x))
ica_df_3
```
```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_4 <- ica_df %>% filter(Province == "balochistan")

ica_df_4$Districts <- ica_df_4$Districts %>%  
  str_replace("chagai", "chaghi") %>%
  str_replace("jaffarabad", "jafarabad") %>% 
  str_replace("kalat", "kallat") %>% 
  str_replace("kech", "kech (turbat)") %>% 
  str_replace("killa abdullah", "qilla abdullah") %>% 
  str_replace("killa saifullah", "qilla saifullah") %>% 
  as.vector()

child_dname_4 <- child_dname %>% filter(RNAME == "Balochistan") %>% left_join(ica_df_4, by = c("dname" = "Districts"))

child_dname_4 %>% group_by(dname) %>% summarize(n = sum(x))
ica_df_4
```



```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_5 <- ica_df %>% filter(Province == "khyber pakhtunkhwa")
ica_df_5

ica_df_5$Districts <- ica_df_5$Districts %>%  
  str_replace("batagram", "battagram") %>%
  str_replace("d. i. khan", "dera ismail khan") %>% 
  str_replace("malakand p area", "malakand") %>% 
  as.vector()

child_dname_5 <- child_dname %>% filter(RNAME == "Khyber Pakhtunkhwa") %>% left_join(ica_df_5, by = c("dname" = "Districts"))

child_dname_5 %>% group_by(dname) %>% summarize(n = sum(x))
ica_df_5

```

```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_6 <- ica_df %>% filter(Province == "gilgit baltistan")

ica_df_6$Districts <- ica_df_6$Districts %>%  
  str_replace("diamir", "diamer") %>%
  str_replace("hunza", "hunza-nagar") %>% 
  as.vector()

child_dname_6 <- child_dname %>% filter(RNAME == "Gilgit-Baltistan") %>% left_join(ica_df_6, by = c("dname" = "Districts"))

child_dname_6 %>% group_by(dname) %>% summarize(n = sum(x))
ica_df_6
```

```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_7 <- ica_df %>% filter(Province == "azad kashmir")

ica_df_7$Districts <- ica_df_7$Districts %>%  
  str_replace("hattian bala", "hattian") %>%
  str_replace("haveli\\(kahuta\\)", "haveli") %>% 
  str_replace("sudhnoti", "sudhnati") %>% 
  as.vector()
>>>>>>> 9f90d2d5e867df4fc1eef511962c1bee40300bcc

child_dname_7 <- child_dname %>% filter(RNAME == "Azad Jammu and Kashmir") %>% left_join(ica_df_7, by = c("dname" = "Districts"))

child_dname_7 %>% group_by(dname) %>% summarize(n = sum(x))
ica_df_7
```

```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_8 <- ica_df %>% filter(Province == "islamabad")
child_dname_8 <- child_dname %>% filter(RNAME == "Islamabad - ICT") %>% left_join(ica_df_8, by = c("dname" = "Districts"))

child_dname_8 %>% group_by(dname) %>% summarize(n = sum(x))
ica_df_8
```

```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_9 <- ica_df %>% filter(Province == "fata")

ica_df_9$Districts <- ica_df_9$Districts %>%  
  str_replace("fr bannu", "f.r. - bannu") %>%
  str_replace("fr d.i.khan", "f.r. - d.i. khan") %>% 
  str_replace("fr kohat", "f.r. - kohat") %>% 
  str_replace("fr lakki marwat", "f.r. - lakki marwat") %>% 
  str_replace("fr peshawar", "f.r. - peshawar") %>% 
  str_replace("fr tank", "f.r. - tank") %>% 
  as.vector()

child_dname_9 <- child_dname %>% filter(RNAME == "Federally Administrated Tribal Areas") %>% left_join(ica_df_9, by = c("dname" = "Districts"))

child_dname_9 %>% group_by(dname) %>% summarize(n = sum(x))
ica_df_9
```
```{r ica_df whose Districts names are renamed,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df
rbind(ica_df_2, ica_df_3, ica_df_4,
      ica_df_5, ica_df_6, ica_df_7,
      ica_df_8, ica_df_9)
```

```{r data child which as location,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
child_ica <- rbind(child_dname_2, child_dname_3, child_dname_4,
      child_dname_5, child_dname_6, child_dname_7,
      child_dname_8, child_dname_9)
```

```{r}
ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(data = child_ica, aes(x, y, label = C003, color = C003)) +
  geom_text(data = child_ica, aes(x, y, label = C003), check_overlap = TRUE, nudge_y = 1)
```

```{r}
ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(data = child_ica, aes(x, y, label = C010, color = C010))
  # geom_text(data = child_ica, aes(x, y, label = C010), check_overlap = TRUE, nudge_y = 1)
```

#### Traial: children, gender
```{r}
child_ica %>% group_by(DID) %>% 
  mutate(gender_ratio = mean(C002))


ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(data = child_ica %>% group_by(DID) %>% 
  mutate(gender_ratio = mean(C002)), aes(x, y, label = gender_ratio, color = gender_ratio))
```

```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
map_child <- map %>% left_join(child, by = c("name" = "DNAME"))

ggplot() +
  geom_polygon(data = pak, aes(long, lat, group = group),
               fill = "white", color = "black") +
  geom_point(data = map_child, aes(long, lat, label = name, color = RNAME)) +
  geom_text(data = map_child, aes(long, lat, label = name), check_overlap = TRUE, nudge_y = 1)


map_child
map
child
```


```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ggplot() +
  geom_polygon(data = pak, aes(long, lat, group = group),
               fill = "white", color = "black") +
  geom_point(data = map_child, aes(long, lat, label = name)) +
  geom_text(data = map_child, aes(long, lat, label = name), check_overlap = TRUE, nudge_y = 1) +
  coord_fixed()

```

#### Districts Map
```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica <- sf::st_read("map/pak_ica_categories_areas_geonode_apr2017.shp")

ggplot(ica) +
  geom_sf() +
  geom_point(data = map_child, aes(long, lat, label = DID)) +
  geom_text(data = map_child, aes(long, lat, label = DID), check_overlap = TRUE)

ica %>% 
  mutate(
    centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(aes(x, y))
```
```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(aes(x, y)) +
  geom_text(aes(x, y, label = Districts),size = 2, check_overlap = TRUE, nudge_y = 1)
```


```{r,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df <- ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
  as.data.frame()
ica_df
ica_df <- ica_df %>% select(Province, Districts, x, y)
ica_df <- ica_df %>% summarize(Province = tolower(Province), Districts = tolower(Districts), x = x, y = y)


```


```{r ica_df_2,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_2 <- ica_df %>% filter(Province == "punjab")
ica_df_2$Districts <- ica_df_2$Districts %>%  
  str_replace("bahawalnagar", "bahawalnager") %>%
  str_replace("jhelum", "Jehlum") %>% 
  str_replace("leiah", "layyah") %>% 
  str_replace("mandi bahauddin", "mandi bahuddin") %>% 
  as.vector()

child_dname <- child %>% mutate(dname = tolower(DNAME))

child_dname_2 <- child_dname %>% filter(RNAME == "Punjab") %>% left_join(ica_df_2, by = c("dname" = "Districts"))


```
```{r ica_df_3, include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_3 <- ica_df %>% filter(Province == "sindh")

ica_df_3$Districts <- ica_df_3$Districts %>%  
  str_replace("ghotki", "gotki") %>%
  str_replace("mirpur khas", "mirpurkhas") %>% 
  str_replace("malir karachi", "karachi-malir-rural") %>% 
  str_replace("naushahro feroze", "nowshero feroze") %>% 
  str_replace("kambar shahdad kot", "qambar shahdadkot") %>% 
  str_replace("sujawal", "sajawal") %>% 
  str_replace("shaheed benazir abad", "shaheed benazirabad") %>% 
  str_replace("tando allahyar", "tando allah yar") %>% 
  as.vector()

child_dname_3 <- child_dname %>% filter(RNAME == "Sindh") %>% left_join(ica_df_3, by = c("dname" = "Districts"))
```
```{r ica_df_4,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_4 <- ica_df %>% filter(Province == "balochistan")

ica_df_4$Districts <- ica_df_4$Districts %>%  
  str_replace("chagai", "chaghi") %>%
  str_replace("jaffarabad", "jafarabad") %>% 
  str_replace("kalat", "kallat") %>% 
  str_replace("kech", "kech (turbat)") %>% 
  str_replace("killa abdullah", "qilla abdullah") %>% 
  str_replace("killa saifullah", "qilla saifullah") %>% 
  as.vector()

child_dname_4 <- child_dname %>% filter(RNAME == "Balochistan") %>% left_join(ica_df_4, by = c("dname" = "Districts"))

```
```{r ica_df_5,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_5 <- ica_df %>% filter(Province == "khyber pakhtunkhwa")
ica_df_5

ica_df_5$Districts <- ica_df_5$Districts %>%  
  str_replace("batagram", "battagram") %>%
  str_replace("d. i. khan", "dera ismail khan") %>% 
  str_replace("malakand p area", "malakand") %>% 
  as.vector()

child_dname_5 <- child_dname %>% filter(RNAME == "Khyber Pakhtunkhwa") %>% left_join(ica_df_5, by = c("dname" = "Districts"))

```
```{r ica_df_6,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_6 <- ica_df %>% filter(Province == "gilgit baltistan")

ica_df_6$Districts <- ica_df_6$Districts %>%  
  str_replace("diamir", "diamer") %>%
  str_replace("hunza", "hunza-nagar") %>% 
  as.vector()

child_dname_6 <- child_dname %>% filter(RNAME == "Gilgit-Baltistan") %>% left_join(ica_df_6, by = c("dname" = "Districts"))

```
```{r ica_df_7,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_7 <- ica_df %>% filter(Province == "azad kashmir")

ica_df_7$Districts <- ica_df_7$Districts %>%  
  str_replace("hattian bala", "hattian") %>%
  str_replace("haveli\\(kahuta\\)", "haveli") %>% 
  str_replace("sudhnoti", "sudhnati") %>% 
  as.vector()

child_dname_7 <- child_dname %>% filter(RNAME == "Azad Jammu and Kashmir") %>% left_join(ica_df_7, by = c("dname" = "Districts"))

```
```{r ica_df_8,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_8 <- ica_df %>% filter(Province == "islamabad")
child_dname_8 <- child_dname %>% filter(RNAME == "Islamabad - ICT") %>% left_join(ica_df_8, by = c("dname" = "Districts"))

```
```{r ica_df_9,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df_9 <- ica_df %>% filter(Province == "fata")

ica_df_9$Districts <- ica_df_9$Districts %>%  
  str_replace("fr bannu", "f.r. - bannu") %>%
  str_replace("fr d.i.khan", "f.r. - d.i. khan") %>% 
  str_replace("fr kohat", "f.r. - kohat") %>% 
  str_replace("fr lakki marwat", "f.r. - lakki marwat") %>% 
  str_replace("fr peshawar", "f.r. - peshawar") %>% 
  str_replace("fr tank", "f.r. - tank") %>% 
  as.vector()

child_dname_9 <- child_dname %>% filter(RNAME == "Federally Administrated Tribal Areas") %>% left_join(ica_df_9, by = c("dname" = "Districts"))
```

```{r ica_df whose Districts names are renamed,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
ica_df
rbind(ica_df_2, ica_df_3, ica_df_4,
      ica_df_5, ica_df_6, ica_df_7,
      ica_df_8, ica_df_9)
```

```{r data child which as location,include=FALSE, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
child_ica <- rbind(child_dname_2, child_dname_3, child_dname_4,
      child_dname_5, child_dname_6, child_dname_7,
      child_dname_8, child_dname_9)
```


```{r C003}
ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(data = child_ica, aes(x, y, label = C003, color = C003)) +
  geom_text(data = child_ica, aes(x, y, label = C003), check_overlap = TRUE, nudge_y = 1)
```

```{r C010}
ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(data = child_ica, aes(x, y, label = C010, color = C010))
  # geom_text(data = child_ica, aes(x, y, label = C010), check_overlap = TRUE, nudge_y = 1)
```

#### Traial: children, gender
```{r gender_ratio}
child_ica %>% group_by(DID) %>% 
  mutate(gender_ratio = mean(C002))


ica %>% 
  mutate(centroid = st_centroid(geometry),
    x = st_coordinates(centroid)[,1],
    y = st_coordinates(centroid)[,2]) %>% 
    ggplot() +
  geom_sf() +
  geom_point(data = child_ica %>% group_by(DID) %>% 
  mutate(gender_ratio = mean(C002)), aes(x, y, label = gender_ratio, color = gender_ratio))
```
<p>0: male, -1: female</p>


